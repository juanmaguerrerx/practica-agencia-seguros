import{s as w,a as V,b as N,c as C,e as E,d as k,f as c}from"./service-BrmabQ8p.js";import{a as S}from"./button.esm-CN5yvFR4.js";import{s as U}from"./dialog.esm-B7dD-diy.js";import{s as D}from"./toast.esm-58rpTpt_.js";import{s as I}from"./calendar.esm-CvvWoFlh.js";import{_ as T,c as B,a as t,w as d,b as s,d as m,o as R,t as _}from"./index-Bbdn3TmC.js";const F={name:"Polizas",components:{DataTable:w,Column:V,Button:S,Dialog:U,InputNumber:N,InputText:C,Toast:D,Tag:E,Dropdown:k,Calendar:I},data(){return{estadosPoliza:["a cuenta","anulada","liquidada","pre anulada"],polizas:[],clientes:[],pagos:[],polizaNueva:{cliente_id:null,numero:null,estado:null,importe:null,notas:null},editVisible:!1,visible:!1,deleteVisible:!1,expandedRows:[],visiblePago:!1,tipoSelected:null,tipoSelectedEstado:null,nuevoPago:{num_poliza:null,notas:null,importe:null,fecha_pago:null},buttondisplay:null,icondisplay:null,templatedisplay:null,maxDate:null}},created(){let a=new Date;this.maxDate=a},async mounted(){this.fetchUsers(),await this.fetchPolizas()},methods:{getSeverityPago(a){switch(a){case"a cuenta":return"contrast";case"anulada":return"danger";case"liquidada":return"success";case"pre anulada":return"warning"}},crearPoliza(){this.polizaNueva.cliente_id=this.tipoSelected.id,this.polizaNueva.estado=this.tipoSelectedEstado,this.visible=!1,console.log(this.polizaNueva),c.post("polizas",this.polizaNueva).then(a=>{console.log(a),this.polizas.push(this.polizaNueva),this.fetchPolizas(),this.$toast.add({severity:"success",summary:"Hecho",detail:"Poliza Creado Correctamente",life:3e3})}).catch(a=>{console.log(a),this.$toast.add({severity:"error",summary:"Error",detail:"Algo ha ido mal :(",life:3e3})}),this.polizaNueva={cliente_id:null,numero:null,estado:null,importe:null,notas:null}},obtenerCliente(a){console.log(a),c.get(`polizas/${a}`).then(e=>{this.polizaNueva=e.data,this.tipoSelected=this.clientes.find(u=>u.id===this.polizaNueva.cliente_id),this.tipoSelectedEstado=this.polizaNueva.estado,this.editVisible=!0,console.log(this.polizaNueva)}).catch(e=>{console.error("Error al obtener cliente:",e)})},confirmDelete(a){this.deleteVisible=!0,this.polizaNueva.id=a},deletePoliza(){console.log(this.polizaNueva.id),c.delete(`/polizas/${this.polizaNueva.id}`).then(a=>{this.deleteVisible=!1,this.$toast.add({severity:"success",summary:"Hecho",detail:"Poliza Borrado Correctamente",life:3e3}),this.polizas=this.polizas.filter(e=>e.id!=this.polizaNueva.id)}).catch(a=>{console.error(a)})},editPoliza(){console.log(this.polizaNueva,this.polizaNueva.id),this.polizaNueva.cliente_id=this.tipoSelected,this.polizaNueva.estado=this.tipoSelectedEstado,c.patch(`polizas/${this.polizaNueva.id}`,this.polizaNueva).then(a=>{console.log(a),this.editVisible=!1,this.fetchPolizas(),this.$toast.add({severity:"success",summary:"Hecho",detail:"Poliza Editada Correctamente",life:3e3})}).catch(a=>{console.error("Error al editar cliente:",a)})},crearPago(a){this.nuevoPago.num_poliza=a,this.visiblePago=!0},confirmNewPago(){const e=new Date(this.nuevoPago.fecha_pago).toISOString().split("T")[0];this.nuevoPago.fecha_pago=e,console.log(this.nuevoPago),this.visiblePago=!1,c.post("pagos",this.nuevoPago).then(u=>{console.log(u),this.fetchPolizas(),this.pagos.push(u.data),this.polizas=this.polizas.map(p=>{if(this.nuevoPago.num_poliza==p.numero){const l=this.pagos.filter(i=>i.num_poliza==p.numero);return{...p,pagos:l}}return p}),this.$toast.add({severity:"success",summary:"Hecho",detail:"Pago Creado Correctamente",life:3e3})}).catch(u=>{console.log(u),this.$toast.add({severity:"error",summary:"Error",detail:"Algo ha ido mal :(",life:3e3})})},async fetchPolizas(){try{const a=await c.get("polizas");this.polizas=a.data;const e=await c.get("pagos");this.pagos=e.data;const u=this.polizas.map(p=>{const l=this.pagos.filter(f=>f.num_poliza==p.numero);let i=0;for(let f of l)i+=parseInt(f.importe);i=parseFloat(p.importe)-i;const v=this.clientes.find(f=>f.id==p.cliente_id),{nombre:r}={...v};return{...p,nombre:r,pagos:l,importe_restante:i.toFixed(2)}});this.polizas=u}catch(a){console.error("Error al obtener usuarios:",a)}},fetchUsers(){c.get("clientes").then(a=>{this.clientes=a.data.map(e=>({...e,empresa:e.empresa===0?"Particular":"Empresa"}))}).catch(a=>{console.error("Error al obtener usuarios:",a)})},enviarPolizaMod(){this.polizaNueva.cliente_id=this.tipoSelected.id,console.log(this.polizaNueva,this.polizaNueva.id),c.put(`polizas/${this.polizaNueva.id}`,this.polizaNueva).then(async a=>{console.log(a),this.editVisible=!1,this.fetchPolizas(),this.$toast.add({severity:"success",summary:"Hecho",detail:"Poliza Editado Correctamente",life:3e3})}).catch(a=>{console.error("Error al editar cliente:",a)})}}},O={class:"mr-44"},A=s("h1",{class:"text-2xl tracking-wide text-center m-5"},"Polizas",-1),H={class:"bg-orange-300 p-1 m-1 w-min rounded"},j={class:"bg-red-300 p-1 m-1 w-min rounded"},q={class:"pl-16 pr-16 pt-5 pb-5 bg-blue-900 bg-opacity-80 rounded-md"},L={class:"text-white"},M=s("span",{class:"p-text-secondary block mb-5 text-green-600"},"Añadir Pago",-1),G={class:"flex align-items-center gap-3 mb-3"},J=s("label",{for:"poliza",class:"font-semibold w-6rem"},"Numero Poliza: ",-1),K={class:"flex align-items-center gap-3 mb-3"},Q=s("label",{for:"notas",class:"font-semibold w-6rem"},"Notas: ",-1),W={class:"flex align-items-center gap-3 mb-3"},X=s("label",{for:"importe",class:"font-semibold w-6rem"},"Importe: ",-1),Y={class:"flex align-items-center gap-3 mb-3"},Z=s("label",{for:"fecha_pago",class:"font-semibold w-6rem"},"Fecha Pago: ",-1),$={class:"flex justify-content-end gap-2 mt-5 ml-28 align-items-center"},ee=s("div",{class:"flex align-items-center gap-3 mb-3"},[s("label",{for:"nombre",class:"font-semibold w-6rem"},"¿Está seguro de borrar el cliente? ")],-1),oe={class:"flex justify-content-end gap-2 mt-5 ml-28 align-items-center"},le=s("span",{class:"p-text-secondary block mb-5 text-green-600"},"Información Personal",-1),te={class:"flex align-items-center gap-3 mb-3"},se=s("label",{for:"nombre",class:"font-semibold w-6rem"},"Cliente: ",-1),ae={class:"flex align-items-center gap-3 mb-3"},ie=s("label",{for:"estado",class:"font-semibold w-6rem"},"Estado: ",-1),ne={class:"flex align-items-center gap-3 mb-3"},re=s("label",{for:"numero",class:"font-semibold w-6rem"},"Numero de Poliza: ",-1),de={class:"flex align-items-center gap-3 mb-3"},pe=s("label",{for:"importe",class:"font-semibold w-6rem"},"Importe total: ",-1),me={class:"flex align-items-center gap-3 mb-3"},ue=s("label",{for:"notas",class:"font-semibold w-6rem"},"Notas de Poliza: ",-1),ce={class:"flex justify-content-end gap-2 mt-5 ml-28 align-items-center"},fe=s("span",{class:"p-text-secondary block mb-5 text-blue-600"},"Información Personal",-1),be={class:"flex align-items-center gap-3 mb-3"},he=s("label",{for:"nombre",class:"font-semibold w-6rem"},"Cliente: ",-1),ge={class:"flex align-items-center gap-3 mb-3"},ve=s("label",{for:"estado",class:"font-semibold w-6rem"},"Estado: ",-1),ze={class:"flex align-items-center gap-3 mb-3"},_e=s("label",{for:"numero",class:"font-semibold w-6rem"},"Numero de Poliza: ",-1),Pe={class:"flex align-items-center gap-3 mb-3"},xe=s("label",{for:"importe",class:"font-semibold w-6rem"},"Importe total: ",-1),ye={class:"flex align-items-center gap-3 mb-3"},we=s("label",{for:"notas",class:"font-semibold w-6rem"},"Notas de Poliza: ",-1),Ve={class:"flex justify-content-end gap-2 mt-5 ml-28 align-items-center"};function Ne(a,e,u,p,l,i){const v=m("Toast"),r=m("Button"),n=m("Column"),f=m("Tag"),P=m("DataTable"),b=m("InputText"),z=m("InputNumber"),y=m("Calendar"),h=m("Dialog"),g=m("Dropdown");return R(),B("div",O,[t(v),A,t(r,{label:"+ Añadir",rounded:"",raised:"",class:"mb-2 p-2 text-green-600",onClick:e[0]||(e[0]=o=>l.visible=!0)}),t(P,{value:l.polizas,expandedRows:l.expandedRows,"onUpdate:expandedRows":e[1]||(e[1]=o=>l.expandedRows=o),class:"mb-10",paginator:"",rows:5,stripedRows:"",rowsPerPageOptions:[5,10,20,50],tableStyle:""},{expansion:d(o=>[s("div",q,[s("h5",L,"Pagos de la póliza #"+_(o.data.numero),1),t(r,{label:"+ Nuevo Pago",rounded:"",class:"m-2 p-1 border text-white",onClick:x=>i.crearPago(o.data.numero)},null,8,["onClick"]),t(P,{value:o.data.pagos,paginator:"",stripedRows:"",rows:5,rowsPerPageOptions:[5,10,20,50]},{default:d(()=>[t(n,{field:"id",header:"#",sortable:""}),t(n,{field:"num_poliza",header:"Poliza",sortable:""}),t(n,{field:"importe",header:"Importe",sortable:""}),t(n,{field:"fecha_pago",header:"Fecha Pago",sortable:""}),t(n,{field:"notas",header:"Notas"})]),_:2},1032,["value"])])]),default:d(()=>[t(n,{expander:"",style:{width:"5rem"}}),t(n,{field:"id",header:"#",sortable:""}),t(n,{field:"nombre",header:"Cliente",sortable:""}),t(n,{field:"numero",header:"Numero",sortable:""}),t(n,{field:"estado",header:"Estado",sortable:""},{body:d(o=>[t(f,{value:o.data.estado,severity:i.getSeverityPago(o.data.estado)},null,8,["value","severity"])]),_:1}),t(n,{field:"importe",header:"Importe Total",sortable:""}),t(n,{field:"importe_restante",header:"Importe Restante",sortable:""}),t(n,{field:"notas",header:"Notas",body:a.tipoTemplate,sortable:""},null,8,["body"]),t(n,{header:"Opciones"},{body:d(o=>[s("div",H,[t(r,{icon:"bi bi-pencil-square",onClick:x=>i.obtenerCliente(o.data.id)},null,8,["onClick"])]),s("div",j,[t(r,{icon:"bi bi-trash",onClick:x=>i.confirmDelete(o.data.id)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","expandedRows"]),t(h,{visible:l.visiblePago,"onUpdate:visible":e[7]||(e[7]=o=>l.visiblePago=o),modal:"",header:"Nuevo Pago",style:{width:"25rem"}},{default:d(()=>[M,s("div",G,[J,t(b,{id:"poliza",modelValue:l.nuevoPago.num_poliza,"onUpdate:modelValue":e[2]||(e[2]=o=>l.nuevoPago.num_poliza=o),readonly:"",class:"flex-auto",autocomplete:"off"},null,8,["modelValue"])]),s("div",K,[Q,t(b,{id:"notas",modelValue:l.nuevoPago.notas,"onUpdate:modelValue":e[3]||(e[3]=o=>l.nuevoPago.notas=o),class:"flex-auto p-1",autocomplete:"off"},null,8,["modelValue"])]),s("div",W,[X,t(z,{id:"importe",modelValue:l.nuevoPago.importe,"onUpdate:modelValue":e[4]||(e[4]=o=>l.nuevoPago.importe=o),class:"flex-auto p-1",autocomplete:"off"},null,8,["modelValue"])]),s("div",Y,[Z,t(y,{modelValue:l.nuevoPago.fecha_pago,"onUpdate:modelValue":e[5]||(e[5]=o=>l.nuevoPago.fecha_pago=o),maxDate:l.maxDate,showButtonBar:"",showIcon:"",iconDisplay:"input",dateFormat:a.yyyy-a.mm-a.dd,inputId:"icondisplay"},null,8,["modelValue","maxDate","dateFormat"])]),s("div",$,[t(r,{type:"button",label:"Cancel",onClick:e[6]||(e[6]=o=>l.visiblePago=!1)}),t(r,{type:"button",label:"Añadir",raised:"",class:"mr-2 p-2 text-green-600",onClick:i.confirmNewPago},null,8,["onClick"])])]),_:1},8,["visible"]),t(h,{visible:l.deleteVisible,"onUpdate:visible":e[9]||(e[9]=o=>l.deleteVisible=o),modal:"",header:"Borrar Poliza",style:{width:"25rem"}},{default:d(()=>[ee,s("div",oe,[t(r,{type:"button",label:"Cancel",onClick:e[8]||(e[8]=o=>l.deleteVisible=!1)}),t(r,{type:"button",label:"Borrar",raised:"",class:"mr-2 p-2 text-red-600",onClick:i.deletePoliza},null,8,["onClick"])])]),_:1},8,["visible"]),t(h,{visible:l.visible,"onUpdate:visible":e[16]||(e[16]=o=>l.visible=o),modal:"",header:"Crear Poliza",style:{width:"25rem"}},{default:d(()=>[le,s("div",te,[se,t(g,{modelValue:l.tipoSelected,"onUpdate:modelValue":e[10]||(e[10]=o=>l.tipoSelected=o),options:l.clientes,optionLabel:"nombre",placeholder:"Cliente",filter:"",class:"w-full md:w-14rem"},{option:d(o=>[s("div",null,_(o.option.nombre),1)]),_:1},8,["modelValue","options"])]),s("div",ae,[ie,t(g,{modelValue:l.tipoSelectedEstado,"onUpdate:modelValue":e[11]||(e[11]=o=>l.tipoSelectedEstado=o),options:l.estadosPoliza,placeholder:"Tipo de Estado"},null,8,["modelValue","options"])]),s("div",ne,[re,t(b,{id:"numero",modelValue:l.polizaNueva.numero,"onUpdate:modelValue":e[12]||(e[12]=o=>l.polizaNueva.numero=o),class:"flex-auto h-8",autocomplete:"off"},null,8,["modelValue"])]),s("div",de,[pe,t(z,{id:"importe",modelValue:l.polizaNueva.importe,"onUpdate:modelValue":e[13]||(e[13]=o=>l.polizaNueva.importe=o),class:"flex-auto p-2",autocomplete:"off"},null,8,["modelValue"])]),s("div",me,[ue,t(b,{id:"notas",modelValue:l.polizaNueva.notas,"onUpdate:modelValue":e[14]||(e[14]=o=>l.polizaNueva.notas=o),class:"flex-auto p-1 h-8",autocomplete:"off"},null,8,["modelValue"])]),s("div",ce,[t(r,{type:"button",label:"Cancel",onClick:e[15]||(e[15]=o=>l.visible=!1)}),t(r,{type:"button",label:"Crear",raised:"",class:"mr-2 p-2 text-green-600",onClick:i.crearPoliza},null,8,["onClick"])])]),_:1},8,["visible"]),t(h,{visible:l.editVisible,"onUpdate:visible":e[23]||(e[23]=o=>l.editVisible=o),modal:"",header:"Editar Poliza",style:{width:"25rem"}},{default:d(()=>[fe,s("div",be,[he,t(g,{modelValue:l.tipoSelected,"onUpdate:modelValue":e[17]||(e[17]=o=>l.tipoSelected=o),options:l.clientes,optionLabel:"nombre",placeholder:"Cliente",filter:"",class:"w-full md:w-14rem"},{option:d(o=>[s("div",null,_(o.option.nombre),1)]),_:1},8,["modelValue","options"])]),s("div",ge,[ve,t(g,{modelValue:l.tipoSelectedEstado,"onUpdate:modelValue":e[18]||(e[18]=o=>l.tipoSelectedEstado=o),options:l.estadosPoliza,placeholder:"Tipo de Estado"},null,8,["modelValue","options"])]),s("div",ze,[_e,t(b,{id:"numero",modelValue:l.polizaNueva.numero,"onUpdate:modelValue":e[19]||(e[19]=o=>l.polizaNueva.numero=o),class:"flex-auto h-8",autocomplete:"off"},null,8,["modelValue"])]),s("div",Pe,[xe,t(z,{id:"importe",modelValue:l.polizaNueva.importe,"onUpdate:modelValue":e[20]||(e[20]=o=>l.polizaNueva.importe=o),class:"flex-auto p-2",autocomplete:"off"},null,8,["modelValue"])]),s("div",ye,[we,t(b,{id:"notas",modelValue:l.polizaNueva.notas,"onUpdate:modelValue":e[21]||(e[21]=o=>l.polizaNueva.notas=o),class:"flex-auto p-1 h-8",autocomplete:"off"},null,8,["modelValue"])]),s("div",Ve,[t(r,{type:"button",label:"Cancel",onClick:e[22]||(e[22]=o=>l.editVisible=!1)}),t(r,{type:"button",label:"Editar",raised:"",class:"mr-2 p-2 text-blue-600",onClick:i.enviarPolizaMod},null,8,["onClick"])])]),_:1},8,["visible"])])}const Ie=T(F,[["render",Ne]]);export{Ie as default};
